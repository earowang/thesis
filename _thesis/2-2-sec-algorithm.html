<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>2.2 Creating a calendar display | Tidy tools for supporting fluent workflow in temporal data analysis</title>
  <meta name="description" content="2.2 Creating a calendar display | Tidy tools for supporting fluent workflow in temporal data analysis">
  <meta name="generator" content="bookdown  and GitBook 2.6.7">

  <meta property="og:title" content="2.2 Creating a calendar display | Tidy tools for supporting fluent workflow in temporal data analysis" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="2.2 Creating a calendar display | Tidy tools for supporting fluent workflow in temporal data analysis" />
  
  
  

<meta name="author" content="Earo Wang">



  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="2-1-introduction.html">
<link rel="next" href="2-3-sec-case.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />










<link rel="stylesheet" href="template/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><strong><a href="./">Temporal tidy tools</a></strong></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome</a></li>
<li class="chapter" data-level="" data-path="acknowledgements.html"><a href="acknowledgements.html"><i class="fa fa-check"></i>Acknowledgements</a></li>
<li class="chapter" data-level="" data-path="preface.html"><a href="preface.html"><i class="fa fa-check"></i>Preface</a><ul>
<li class="chapter" data-level="" data-path="preface.html"><a href="preface.html#open-and-reproducible-research"><i class="fa fa-check"></i>Open and reproducible research</a></li>
<li class="chapter" data-level="" data-path="preface.html"><a href="preface.html#license"><i class="fa fa-check"></i>License</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="1-ch-intro.html"><a href="1-ch-intro.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="1-1-sec-calendar-vis.html"><a href="1-1-sec-calendar-vis.html"><i class="fa fa-check"></i><b>1.1</b> Calendar-based graphics</a></li>
<li class="chapter" data-level="1.2" data-path="1-2-sec-tsibble.html"><a href="1-2-sec-tsibble.html"><i class="fa fa-check"></i><b>1.2</b> Tidy temporal data structure</a></li>
<li class="chapter" data-level="1.3" data-path="1-3-sec-mists.html"><a href="1-3-sec-mists.html"><i class="fa fa-check"></i><b>1.3</b> Missingness in time</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="2-ch-calendar-vis.html"><a href="2-ch-calendar-vis.html"><i class="fa fa-check"></i><b>2</b> Calendar-based graphics for visualizing people’s daily schedules</a><ul>
<li class="chapter" data-level="2.1" data-path="2-1-introduction.html"><a href="2-1-introduction.html"><i class="fa fa-check"></i><b>2.1</b> Introduction</a></li>
<li class="chapter" data-level="2.2" data-path="2-2-sec-algorithm.html"><a href="2-2-sec-algorithm.html"><i class="fa fa-check"></i><b>2.2</b> Creating a calendar display</a><ul>
<li class="chapter" data-level="2.2.1" data-path="2-2-sec-algorithm.html"><a href="2-2-sec-algorithm.html#sec:transformation"><i class="fa fa-check"></i><b>2.2.1</b> Data transformation</a></li>
<li class="chapter" data-level="2.2.2" data-path="2-2-sec-algorithm.html"><a href="2-2-sec-algorithm.html#sec:opt"><i class="fa fa-check"></i><b>2.2.2</b> Options</a></li>
<li class="chapter" data-level="2.2.3" data-path="2-2-sec-algorithm.html"><a href="2-2-sec-algorithm.html#sec:variations"><i class="fa fa-check"></i><b>2.2.3</b> Variations</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="2-3-sec-case.html"><a href="2-3-sec-case.html"><i class="fa fa-check"></i><b>2.3</b> Case study</a></li>
<li class="chapter" data-level="2.4" data-path="2-4-sec-discussion.html"><a href="2-4-sec-discussion.html"><i class="fa fa-check"></i><b>2.4</b> Discussion</a></li>
<li class="chapter" data-level="" data-path="acknowledgements-1.html"><a href="acknowledgements-1.html"><i class="fa fa-check"></i>Acknowledgements</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="3-ch-tsibble.html"><a href="3-ch-tsibble.html"><i class="fa fa-check"></i><b>3</b> A new tidy data structure to support exploration and modeling of temporal data</a><ul>
<li class="chapter" data-level="3.1" data-path="3-1-sec-intro.html"><a href="3-1-sec-intro.html"><i class="fa fa-check"></i><b>3.1</b> Introduction</a></li>
<li class="chapter" data-level="3.2" data-path="3-2-sec-str.html"><a href="3-2-sec-str.html"><i class="fa fa-check"></i><b>3.2</b> Data structures</a><ul>
<li class="chapter" data-level="3.2.1" data-path="3-2-sec-str.html"><a href="3-2-sec-str.html#sec:time-series"><i class="fa fa-check"></i><b>3.2.1</b> Time series and longitudinal data</a></li>
<li class="chapter" data-level="3.2.2" data-path="3-2-sec-str.html"><a href="3-2-sec-str.html#tidy-data-and-the-grammar-of-data-manipulation"><i class="fa fa-check"></i><b>3.2.2</b> Tidy data and the grammar of data manipulation</a></li>
<li class="chapter" data-level="3.2.3" data-path="3-2-sec-str.html"><a href="3-2-sec-str.html#existing-time-series-standards-in-r"><i class="fa fa-check"></i><b>3.2.3</b> Existing time series standards in R</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="3-3-sec-semantics.html"><a href="3-3-sec-semantics.html"><i class="fa fa-check"></i><b>3.3</b> Contextual semantics</a><ul>
<li class="chapter" data-level="3.3.1" data-path="3-3-sec-semantics.html"><a href="3-3-sec-semantics.html#sec:index"><i class="fa fa-check"></i><b>3.3.1</b> Index</a></li>
<li class="chapter" data-level="3.3.2" data-path="3-3-sec-semantics.html"><a href="3-3-sec-semantics.html#sec:key"><i class="fa fa-check"></i><b>3.3.2</b> Key</a></li>
<li class="chapter" data-level="3.3.3" data-path="3-3-sec-semantics.html"><a href="3-3-sec-semantics.html#sec:interval"><i class="fa fa-check"></i><b>3.3.3</b> Interval</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="3-4-sec-pipeline.html"><a href="3-4-sec-pipeline.html"><i class="fa fa-check"></i><b>3.4</b> Data pipelines</a><ul>
<li class="chapter" data-level="3.4.1" data-path="3-4-sec-pipeline.html"><a href="3-4-sec-pipeline.html#sec:timepipeline"><i class="fa fa-check"></i><b>3.4.1</b> Time series transformation</a></li>
<li class="chapter" data-level="3.4.2" data-path="3-4-sec-pipeline.html"><a href="3-4-sec-pipeline.html#sec:ts-vis"><i class="fa fa-check"></i><b>3.4.2</b> Time series visualization</a></li>
<li class="chapter" data-level="3.4.3" data-path="3-4-sec-pipeline.html"><a href="3-4-sec-pipeline.html#sec:ts-models"><i class="fa fa-check"></i><b>3.4.3</b> Time series models</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="3-5-sec-software.html"><a href="3-5-sec-software.html"><i class="fa fa-check"></i><b>3.5</b> Software structure and design decisions</a><ul>
<li class="chapter" data-level="3.5.1" data-path="3-5-sec-software.html"><a href="3-5-sec-software.html#data-first"><i class="fa fa-check"></i><b>3.5.1</b> Data first</a></li>
<li class="chapter" data-level="3.5.2" data-path="3-5-sec-software.html"><a href="3-5-sec-software.html#functional-programming"><i class="fa fa-check"></i><b>3.5.2</b> Functional programming</a></li>
<li class="chapter" data-level="3.5.3" data-path="3-5-sec-software.html"><a href="3-5-sec-software.html#modularity"><i class="fa fa-check"></i><b>3.5.3</b> Modularity</a></li>
<li class="chapter" data-level="3.5.4" data-path="3-5-sec-software.html"><a href="3-5-sec-software.html#extensibility"><i class="fa fa-check"></i><b>3.5.4</b> Extensibility</a></li>
<li class="chapter" data-level="3.5.5" data-path="3-5-sec-software.html"><a href="3-5-sec-software.html#tidy-evaluation"><i class="fa fa-check"></i><b>3.5.5</b> Tidy evaluation</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="3-6-sec-cases.html"><a href="3-6-sec-cases.html"><i class="fa fa-check"></i><b>3.6</b> Case studies</a><ul>
<li class="chapter" data-level="3.6.1" data-path="3-6-sec-cases.html"><a href="3-6-sec-cases.html#on-time-performance-for-domestic-flights-in-u.s.a"><i class="fa fa-check"></i><b>3.6.1</b> On-time performance for domestic flights in U.S.A</a></li>
<li class="chapter" data-level="3.6.2" data-path="3-6-sec-cases.html"><a href="3-6-sec-cases.html#smart-grid-customer-data-in-australia"><i class="fa fa-check"></i><b>3.6.2</b> Smart-grid customer data in Australia</a></li>
</ul></li>
<li class="chapter" data-level="3.7" data-path="3-7-sec-conclusion.html"><a href="3-7-sec-conclusion.html"><i class="fa fa-check"></i><b>3.7</b> Conclusion and future work</a></li>
<li class="chapter" data-level="" data-path="acknowledgements-2.html"><a href="acknowledgements-2.html"><i class="fa fa-check"></i>Acknowledgements</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="4-ch-mists.html"><a href="4-ch-mists.html"><i class="fa fa-check"></i><b>4</b> Missingness in time: speaking the language of data</a><ul>
<li class="chapter" data-level="4.1" data-path="4-1-introduction-1.html"><a href="4-1-introduction-1.html"><i class="fa fa-check"></i><b>4.1</b> Introduction</a></li>
<li class="chapter" data-level="4.2" data-path="4-2-process-for-generating-missing-data-in-time.html"><a href="4-2-process-for-generating-missing-data-in-time.html"><i class="fa fa-check"></i><b>4.2</b> Process for generating missing data in time</a></li>
<li class="chapter" data-level="4.3" data-path="4-3-tools-for-exploring-temporal-patterns-of-missingness.html"><a href="4-3-tools-for-exploring-temporal-patterns-of-missingness.html"><i class="fa fa-check"></i><b>4.3</b> Tools for exploring temporal patterns of missingness</a></li>
<li class="chapter" data-level="4.4" data-path="4-4-assessing-results-of-imputation-techniques.html"><a href="4-4-assessing-results-of-imputation-techniques.html"><i class="fa fa-check"></i><b>4.4</b> Assessing results of imputation techniques</a></li>
<li class="chapter" data-level="4.5" data-path="4-5-case-study.html"><a href="4-5-case-study.html"><i class="fa fa-check"></i><b>4.5</b> Case study</a></li>
<li class="chapter" data-level="4.6" data-path="4-6-discussions.html"><a href="4-6-discussions.html"><i class="fa fa-check"></i><b>4.6</b> Discussions</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="5-ch-conclusion.html"><a href="5-ch-conclusion.html"><i class="fa fa-check"></i><b>5</b> Conclusion and future plans</a><ul>
<li class="chapter" data-level="5.1" data-path="5-1-software-development.html"><a href="5-1-software-development.html"><i class="fa fa-check"></i><b>5.1</b> Software development</a></li>
<li class="chapter" data-level="5.2" data-path="5-2-future-work.html"><a href="5-2-future-work.html"><i class="fa fa-check"></i><b>5.2</b> Future work</a></li>
<li class="chapter" data-level="5.3" data-path="5-3-final-words.html"><a href="5-3-final-words.html"><i class="fa fa-check"></i><b>5.3</b> Final words</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="bibliography.html"><a href="bibliography.html"><i class="fa fa-check"></i>Bibliography</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Proudly published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Tidy tools for supporting fluent workflow in temporal data analysis</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="sec:algorithm" class="section level2">
<h2><span class="header-section-number">2.2</span> Creating a calendar display</h2>
<div id="sec:transformation" class="section level3">
<h3><span class="header-section-number">2.2.1</span> Data transformation</h3>
<p>The algorithm of transforming data for constructing a calendar plot uses linear algebra, similar to that used in the glyph map displays for spatio-temporal data <span class="citation">(Wickham et al. <a href="bibliography.html#ref-Wickham2012glyph">2012</a>)</span>. To make a year long calendar requires cells for days, embedded in blocks corresponding to months, organized into a grid layout for a year. Each month can be captured with 35 (5 <span class="math inline">\(\times\)</span> 7) cells, where the top left is Monday of week 1, and the bottom right is Sunday of week 5 by default. These cells provide a micro canvas on which to plot the data. The first day of the month could be any of Monday–Sunday, which is determined by the year of the calendar. Months are of different lengths, ranging from 28 to 31 days, and each month could extend over six weeks but the convention in these months is to wrap the last few days up to the top row of the block. The notation for creating these cells is as follows:</p>
<ul>
<li><span class="math inline">\(k = 1, \dots , 7\)</span> is the day of the week that is the first day of the month.</li>
<li><span class="math inline">\(d = 28, 29, 30\)</span> or <span class="math inline">\(31\)</span> representing the number of days in any month.</li>
<li><span class="math inline">\((i, j)\)</span> is the grid position where <span class="math inline">\(1 \le i \le 5\)</span> is week within the month, <span class="math inline">\(1 \le j \le 7\)</span>, is day of the week.</li>
<li><span class="math inline">\(g = k, \dots,(k+d)\)</span> indexes the day in the month, inside the 35 possible cells.</li>
</ul>
<p>The grid position for any day in the month is given by</p>
<p><span class="math display" id="eq:grid">\[\begin{equation}
  \begin{aligned}
  i &amp;= \lceil (g \text{ mod } 35) / 7\rceil, \\
  j &amp;= g \text{ mod } 7.
  \end{aligned}
  \tag{2.1}
\end{equation}\]</span></p>
<p>Figure <a href="2-2-sec-algorithm.html#fig:month-diagram">2.4</a> illustrates this <span class="math inline">\((i,j)\)</span> layout for a month where <span class="math inline">\(k=5\)</span>.</p>
<div class="figure" style="text-align: center"><span id="fig:month-diagram"></span>
<img src="img/month.png" alt="Illustration of the indexing layout for cells in a month, where \(k\) is day of the week, \(g\) is day of the month, \((i, j)\) indicates grid position." width="100%" />
<p class="caption">
Figure 2.4: Illustration of the indexing layout for cells in a month, where <span class="math inline">\(k\)</span> is day of the week, <span class="math inline">\(g\)</span> is day of the month, <span class="math inline">\((i, j)\)</span> indicates grid position.
</p>
</div>

<p>To create the layout for a full year, <span class="math inline">\((m, n)\)</span> denotes the position of the month arranged in the plot, where <span class="math inline">\(1 \le m \le M\)</span> and <span class="math inline">\(1 \le n \le N\)</span>; <span class="math inline">\(b\)</span> denotes the small amount of white space between each month for visual separation. Figure <a href="2-2-sec-algorithm.html#fig:year-diagram">2.5</a> illustrates this layout where <span class="math inline">\(M = 3\)</span> and <span class="math inline">\(N = 4\)</span>.</p>
<div class="figure" style="text-align: center"><span id="fig:year-diagram"></span>
<img src="img/year-diagram.png" alt="Illustration of the indexing layout for months of one year, where \(M\) and \(N\) indicate number of rows and columns, \(b\) is a space parameter separating cells." width="100%" />
<p class="caption">
Figure 2.5: Illustration of the indexing layout for months of one year, where <span class="math inline">\(M\)</span> and <span class="math inline">\(N\)</span> indicate number of rows and columns, <span class="math inline">\(b\)</span> is a space parameter separating cells.
</p>
</div>

<p>Each cell forms a canvas on which to draw the data. Initialize the canvas to have limits <span class="math inline">\([0, 1]\)</span> both horizontally and vertically. For the pedestrian sensor data, within each cell, hour is plotted horizontally and count is plotted vertically. Each variable is scaled to have values in <span class="math inline">\([0, 1]\)</span>, using the minimum and maximum of all the data values to be displayed, assuming fixed scales. Let <span class="math inline">\(h\)</span> be the scaled hour, and <span class="math inline">\(c\)</span> the scaled count.</p>
<p>Then the final points for making the calendar line plots of the pedestrian sensor data is given by:</p>
<p><span class="math display" id="eq:final">\[\begin{equation}
  \begin{aligned}
  x &amp;= j + (n - 1) \times 7 + (n - 1) \times b + h, \\
  y &amp;= i - (m - 1) \times 5 - (m - 1) \times b + c.
  \end{aligned}
  \tag{2.2}
\end{equation}\]</span></p>
<p>Note that for the vertical direction, the top left is the starting point of the grid (in Figure <a href="2-2-sec-algorithm.html#fig:month-diagram">2.4</a>) which is why subtraction is performed. Within each cell, the starting position is the bottom left.</p>
<div class="figure" style="text-align: center"><span id="fig:fs-2016"></span>
<img src="figure/fs-2016-1.png" alt="The calendar-based display of hourly foot traffic at Flagstaff Station using line glyphs. The disparities between week day and weekend along with public holiday are immediately apparent. The arrangement of the data into a \(3 \times 4\) monthly grid represents all the traffic in 2016. Note that the algorithm wraps the last few days in the sixth week to the top row of each month block for a compact layout, which occurs to May and October." width="100%" />
<p class="caption">
Figure 2.6: The calendar-based display of hourly foot traffic at Flagstaff Station using line glyphs. The disparities between week day and weekend along with public holiday are immediately apparent. The arrangement of the data into a <span class="math inline">\(3 \times 4\)</span> monthly grid represents all the traffic in 2016. Note that the algorithm wraps the last few days in the sixth week to the top row of each month block for a compact layout, which occurs to May and October.
</p>
</div>

<p>Figure <a href="2-2-sec-algorithm.html#fig:fs-2016">2.6</a> shows the line glyphs framed in the monthly calendar over the year 2016. This is achieved by the <code>frame_calendar</code> function, which computes the coordinates on the calendar for the input data variables. These can then be plotted using the usual <strong>ggplot2</strong> R package <span class="citation">(H. Wickham, Chang, et al. <a href="bibliography.html#ref-R-ggplot2">2018</a>)</span> functions. All of the grammar of graphics can be applied.</p>
<p>In order to make calendar-based graphics more accessible and informative, reference lines dividing each cell and block as well as labels indicating week day and month are also computed before plot construction.</p>
<p>Regarding the monthly calendar, the major reference lines separate every month panel and the minor ones separate every cell, represented by the thick and thin lines in Figure <a href="2-2-sec-algorithm.html#fig:fs-2016">2.6</a>, respectively. The major reference lines are placed surrounding every month block: for each <span class="math inline">\(m\)</span>, the vertical lines are determined by <span class="math inline">\(\min{(x)}\)</span> and <span class="math inline">\(\max{(x)}\)</span>; for each <span class="math inline">\(n\)</span>, the horizontal lines are given by <span class="math inline">\(\min{(y)}\)</span> and <span class="math inline">\(\max{(y)}\)</span>. The minor reference lines are only placed on the left side of every cell: for each <span class="math inline">\(i\)</span>, the vertical division is <span class="math inline">\(\min{(x)}\)</span>; for each <span class="math inline">\(j\)</span>, the horizontal is <span class="math inline">\(\min{(y)}\)</span>.</p>
<p>The month labels located on the top left using <span class="math inline">\((\min{(x)}, \max{(y)})\)</span> for every <span class="math inline">\((m, n)\)</span>. The week day texts are uniformly positioned on the bottom of the whole canvas, that is <span class="math inline">\(\min{(y)}\)</span>, with the central position of a cell <span class="math inline">\(x / 2\)</span> for each <span class="math inline">\(j\)</span>.</p>
</div>
<div id="sec:opt" class="section level3">
<h3><span class="header-section-number">2.2.2</span> Options</h3>
<p>The algorithm has several optional parameters that modify the layout, direction of display, scales, plot size and switching to polar coordinates. These are accessible to the user by the inputs to the function <code>frame_calendar</code>:</p>
<pre><code>frame_calendar(data, x, y, date, calendar = &quot;monthly&quot;, dir = &quot;h&quot;, 
  sunday = FALSE, nrow = NULL, ncol = NULL, polar = FALSE, scale = &quot;fixed&quot;, 
  width = 0.95, height = 0.95, margin = NULL)</code></pre>
<p>It is assumed that the <code>data</code> is in tidy format <span class="citation">(Wickham <a href="bibliography.html#ref-wickham2014tidy">2014</a>)</span>, and <code>x</code>, <code>y</code> are the variables that will be mapped to the horizontal and vertical axes in each cell. For example, the <code>x</code> is the time of the day, and <code>y</code> is the count (Figure <a href="2-2-sec-algorithm.html#fig:fs-2016">2.6</a>). The <code>date</code> argument specifies the date variable used to construct the calendar layout.</p>
<p>The algorithm handles displaying a single month or several years. The arguments <code>nrow</code> and <code>ncol</code> specify the layout of multiple months. For some time frames, some arrangements may be more beneficial than others. For example, to display data for three years, setting <code>nrow = 3</code> and <code>ncol = 12</code> would show each year on a single row.</p>
<div id="layouts" class="section level4">
<h4><span class="header-section-number">2.2.2.1</span> Layouts</h4>
<p>The monthly calendar is the default, but two other formats, weekly and daily, are available with the <code>calendar</code> argument. The daily calendar arranges days along a row, one row per month. The weekly calendar stacks weeks of the year vertically, one row for each week, and one column for each day. The reader can scan down all the Mondays of the year, for example. The daily layout puts more emphasis on day of the month. The weekly calendar is appropriate if most of the variation can be characterized by days of the week. On the other hand, the daily calendar should be used when there is a yearly effect but not a weekly effect in the data (for example weather data). When both effects are present, the monthly calendar would be a better choice. Temporal patterns motivate which variant should be employed.</p>
</div>
<div id="polar-transformation" class="section level4">
<h4><span class="header-section-number">2.2.2.2</span> Polar transformation</h4>
<p>When <code>polar = TRUE</code>, a polar transformation is carried out on the data. The computation is similar to the one described in <span class="citation">Wickham et al. (<a href="bibliography.html#ref-Wickham2012glyph">2012</a>)</span>. The resulting plot is star glyphs embedded in the monthly calendar layout. Star glyphs are time series lines transformed in polar coordinates.</p>

</div>
<div id="scales" class="section level4">
<h4><span class="header-section-number">2.2.2.3</span> Scales</h4>
<p>By default, global scaling is done for values in each plot, with the global minimum and maximum used to fit values into each cell. If the emphasis is comparing trend rather than magnitude, it is useful to scale locally. For temporal data this would harness the temporal components. The choices include: free scale within each cell (<code>free</code>), cells derived from the same day of the week (<code>free_wday</code>), or cells from the same day of the month (<code>free_mday</code>). The scaling allows for the comparisons of absolute or relative values, and the emphasis of different temporal variations.</p>
<p>With local scaling, the overall variation gives way to the individual shape. Figure <a href="2-2-sec-algorithm.html#fig:fs-free">2.7</a> shows the same data as Figure <a href="2-2-sec-algorithm.html#fig:fs-2016">2.6</a> scaled locally using <code>scale = &quot;free&quot;</code>. The daily trends are magnified.</p>
<div class="figure" style="text-align: center"><span id="fig:fs-free"></span>
<img src="figure/fs-free-1.png" alt="Line glyphs on the calendar format showing hourly foot traffic at Flagstaff Station, scaled over all the days. The individual shape on a single day becomes more distinctive, however it is impossible to compare the size of peaks between days." width="100%" />
<p class="caption">
Figure 2.7: Line glyphs on the calendar format showing hourly foot traffic at Flagstaff Station, scaled over all the days. The individual shape on a single day becomes more distinctive, however it is impossible to compare the size of peaks between days.
</p>
</div>

<p>The <code>free_wday</code> scales each week day together. It can be useful to comparing trends across week days, allowing relative patterns for weekends versus week days to be examined. Similarly, the <code>free_mday</code> uses free scaling for any day within a given month.</p>
</div>
<div id="orientation" class="section level4">
<h4><span class="header-section-number">2.2.2.4</span> Orientation</h4>
<p>By default, grids are laid out horizontally. This can be transposed by setting the <code>dir</code> parameter to <code>&quot;v&quot;</code>, in which case <span class="math inline">\(i\)</span> and <span class="math inline">\(j\)</span> are swapped in Equation <a href="2-2-sec-algorithm.html#eq:grid">(2.1)</a>. This can be useful for creating calendar layouts for countries where vertical layout is the convention.</p>
</div>
<div id="language-support" class="section level4">
<h4><span class="header-section-number">2.2.2.5</span> Language support</h4>
<p>Most countries have adopted this western calendar layout, while the languages used for week day and month would be different across countries. We also offer language specifications other than English for text labelling.</p>
</div>
</div>
<div id="sec:variations" class="section level3">
<h3><span class="header-section-number">2.2.3</span> Variations</h3>
<div id="overlaying-and-faceting-subsets" class="section level4">
<h4><span class="header-section-number">2.2.3.1</span> Overlaying and faceting subsets</h4>
<p>Plots can be layered. The comparison of sensors can be done by overlaying the values for each (Figure <a href="2-2-sec-algorithm.html#fig:overlay">2.8</a>). Differences between the pedestrian patterns at these sensors can be seen. Flagstaff Station exhibits strong commuters patterns, with fewer pedestrian counts during the weekends and public holidays. This suggests that Flagstaff Station has limited functionality on non-work days. From Figure <a href="2-2-sec-algorithm.html#fig:overlay">2.8</a> it can be seen that Birrarung Marr has a distinct temporal pattern from the other two all year round. The nighttime events, such as White Night, have barely affected the operation of Flagstaff Station but heavily affected the incoming and outgoing traffic to the State Library and Birrarung Marr.</p>
<div class="figure" style="text-align: center"><span id="fig:overlay"></span>
<img src="figure/overlay-1.png" alt="Overlaying line graphs of the three sensors in the monthly calendar. Three sensors demonstrate very different traffic patterns. Birrarung Marr tends to attract many pedestrians for special events held on weekends, contrasting to the bimodal commuting traffic at Flagstaff Station." width="100%" />
<p class="caption">
Figure 2.8: Overlaying line graphs of the three sensors in the monthly calendar. Three sensors demonstrate very different traffic patterns. Birrarung Marr tends to attract many pedestrians for special events held on weekends, contrasting to the bimodal commuting traffic at Flagstaff Station.
</p>
</div>

<p>To avoid the overlapping problem, the calendar layout can be embedded into a series of subplots for the different sensors. Figure <a href="2-2-sec-algorithm.html#fig:facet">2.9</a> presents the idea of faceting calendar plots. This allows comparing the overall structure between sensors, while emphasizing individual sensor variation. In particular, it can be immediately learned that Birrarung Marr was busy and packed, for example during the Australian Open, a major international tennis tournament, in the last two weeks of January. This is concealed in the conventional graphics.</p>
<div class="figure" style="text-align: center"><span id="fig:facet"></span>
<img src="figure/facet-1.png" alt="Line charts, embedded in the \(6 \times 2\) monthly calendar, colored and faceted by the 3 sensors. The variations of an individual sensor are emphasised, and the shapes can be compared across the cells and sensors." width="100%" />
<p class="caption">
Figure 2.9: Line charts, embedded in the <span class="math inline">\(6 \times 2\)</span> monthly calendar, colored and faceted by the 3 sensors. The variations of an individual sensor are emphasised, and the shapes can be compared across the cells and sensors.
</p>
</div>

</div>
<div id="different-types-of-plots" class="section level4">
<h4><span class="header-section-number">2.2.3.2</span> Different types of plots</h4>
<p>The <code>frame_calendar</code> function is not constrained to line plots. The full range of plotting capabilities in <strong>ggplot2</strong> is essentially available. Figure <a href="2-2-sec-algorithm.html#fig:scatterplot">2.10</a> shows a lag scatterplot at Flagstaff Station, where the lagged hourly count is assigned to the <code>x</code> argument and the current hourly count to the <code>y</code> argument. This figure is organized in the daily calendar layout. Figure <a href="2-2-sec-algorithm.html#fig:scatterplot">2.10</a> indicates two primary patterns, strong autocorrelation on weekends, and weaker autocorrelation on work days. At the higher counts, on week days, the next hour sees possibly substantial increase or decrease in counts, essentially revealing a bimodal distribution of consecutive counts, as supported by Figure <a href="2-2-sec-algorithm.html#fig:fs-2016">2.6</a>.</p>
<div class="figure" style="text-align: center"><span id="fig:scatterplot"></span>
<img src="figure/scatterplot-1.png" alt="Lag scatterplot in the daily calendar layout. Each hour’s count is plotted against previous hour’s count at Flagstaff Station to demonstrate the autocorrelation at lag 1. The correlation between them is more consistent on non-work days than work days." width="100%" />
<p class="caption">
Figure 2.10: Lag scatterplot in the daily calendar layout. Each hour’s count is plotted against previous hour’s count at Flagstaff Station to demonstrate the autocorrelation at lag 1. The correlation between them is more consistent on non-work days than work days.
</p>
</div>

<p>The algorithm can also produce more complicated plots, such as boxplots. Figure <a href="2-2-sec-algorithm.html#fig:boxplot">2.11</a> uses a loess smooth line <span class="citation">(Cleveland <a href="bibliography.html#ref-cleveland1979loess">1979</a>)</span> superimposed on side-by-side boxplots. It shows the distribution of hourly counts across all 43 sensors during December. The last week of December is the holiday season: people are off work on the day before Christmas (December 24), go shopping on the Boxing day (December 26), and stay out for the fireworks on New Year’s Eve.</p>
<div class="figure" style="text-align: center"><span id="fig:boxplot"></span>
<img src="figure/boxplot-1.png" alt="Side-by-side boxplots of hourly counts for all the 43 sensors in December 2016, with the loess smooth line superimposed on each day. It shows the hourly distribution in the city as a whole. There is one sensor attracting a larger number of people on New Year's Eve than the rest." width="100%" />
<p class="caption">
Figure 2.11: Side-by-side boxplots of hourly counts for all the 43 sensors in December 2016, with the loess smooth line superimposed on each day. It shows the hourly distribution in the city as a whole. There is one sensor attracting a larger number of people on New Year’s Eve than the rest.
</p>
</div>
<div class="figure" style="text-align: center"><span id="fig:chn"></span>
<img src="figure/chn-1.png" alt="The same plot as Figure 2.11, but with the month and week day labels in Chinese. It demonstrates the natural support for languages other than English." width="100%" />
<p class="caption">
Figure 2.12: The same plot as Figure <a href="2-2-sec-algorithm.html#fig:boxplot">2.11</a>, but with the month and week day labels in Chinese. It demonstrates the natural support for languages other than English.
</p>
</div>

</div>
<div id="interactivity" class="section level4">
<h4><span class="header-section-number">2.2.3.3</span> Interactivity</h4>
<p>As a data restructuring tool, the interactivity of calendar-based displays can be easily enabled, as long as the interactive graphic system remains true to the spirit of the grammar of graphics, for example <strong>plotly</strong> <span class="citation">(Sievert <a href="bibliography.html#ref-plotly">2018</a>)</span> in R. As a standalone display, an interactive tooltip can be added to show labels when mousing over it in the calendar layout, for example the hourly count with the time of day. It is difficult to sense the values from the static display, but the tooltip makes it possible. Options in the <code>frame_calendar</code> function can be ported to a form of selection button or text input in a graphical user interface like R shiny <span class="citation">(Chang et al. <a href="bibliography.html#ref-R-shiny">2018</a>)</span>. The display will update on the fly accordingly via clicking or text input, as desired.</p>
<p>Linking calendar displays to other types of charts is valuable to visually explore the relationships between variables. An example can be found in the <strong>wanderer4melb</strong> shiny application <span class="citation">(Wang <a href="bibliography.html#ref-R-wanderer4melb">2018</a>)</span>. The calendar most naturally serves as a tool for date selection: by selecting and brushing the glyphs in the calendar, it subsequently highlights the elements of corresponding dates in other time-based plots. Conversely, selecting on weather data plots, linked to the calendar can help to assess if very hot/cold days and heavy rain affect the number of people walking in downtown Melbourne. The linking between weather data and calendar display is achieved using the common dates.</p>
</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="2-1-introduction.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="2-3-sec-case.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/earowang/thesis/edit/master/Rmd/02-calendar-vis.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"download": ["thesis.pdf"],
"toc": {
"collapse": "none"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
